<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="Link to challenge: Snapped Phish-ing line
The task An Ordinary Midsummer Day&hellip; As an IT department personnel of SwiftSpend Financial, one of your responsibilities is to support your fellow employees with their technical concerns. While everything seemed ordinary and mundane, this gradually changed when several employees from various departments started reporting an unusual email they had received. Unfortunately, some had already submitted their credentials and could no longer log in.">  

  <title>
    
      CTF writeup: Snapped Phish-ing Line (TryHackMe)
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.3261f53b048c2c040ff46432afee3d5a46197b03f8b24f68f6c0e4db3c6abeb79b10060ff01993277938c20526aa55b2d1ad5607cb4e2902d4d41120d370916a.css" integrity="sha512-MmH1OwSMLAQP9GQyr&#43;49WkYZewP4sk9o9sDk2zxqvrebEAYP8BmTJ3k4wgUmqlWy0a1WB8tOKQLU1BEg03CRag==" />
  
</head>
<body><div class="topnav-container">
    <div class="nav-container">
        <div class="theme-toggle">
            <input type="checkbox" id="ChangeTheme"/>
            <label for="ChangeTheme"> 
                <svg class="moon" id="Moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polygon points="22 17 22 19 21 19 21 20 20 20 20 21 18 21 18 22 16 22 16 23 10 23 10 22 8 22 8 21 6 21 6 20 5 20 5 19 4 19 4 17 3 17 3 15 2 15 2 9 3 9 3 7 4 7 4 5 5 5 5 4 6 4 6 3 8 3 8 2 10 2 10 1 15 1 15 2 13 2 13 3 11 3 11 4 10 4 10 6 9 6 9 8 8 8 8 12 9 12 9 14 10 14 10 16 11 16 11 17 13 17 13 18 15 18 15 19 19 19 19 18 21 18 21 17 22 17"/></svg>
                <svg class="sun" id="Sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polygon points="17 10 17 14 16 14 16 15 15 15 15 16 14 16 14 17 10 17 10 16 9 16 9 15 8 15 8 14 7 14 7 10 8 10 8 9 9 9 9 8 10 8 10 7 14 7 14 8 15 8 15 9 16 9 16 10 17 10"/><path d="m21,11v-1h1v-1h1v-2h-3v-1h-2v-2h-1V1h-2v1h-1v1h-1v1h-2v-1h-1v-1h-1v-1h-2v3h-1v2h-2v1H1v2h1v1h1v1h1v2h-1v1h-1v1h-1v2h3v1h2v2h1v3h2v-1h1v-1h1v-1h2v1h1v1h1v1h2v-3h1v-2h2v-1h3v-2h-1v-1h-1v-1h-1v-2h1Zm-3,4h-1v1h-1v1h-1v1h-6v-1h-1v-1h-1v-1h-1v-6h1v-1h1v-1h1v-1h6v1h1v1h1v1h1v6Z"/></svg>
            </label>
        </div>
        <ul id="menu">
            <a href="/">
                home
            </a>
            <a href="/posts/">
                posts
            </a>
            <a href="/tags/">
                tags
            </a>
        </ul>
    </div>
</div>

<script>
var checkbox = document.getElementById("ChangeTheme"); 


if (sessionStorage.getItem("mode") == "dark") {
  darkmode();
} else {
  nodark();
}


checkbox.addEventListener("change", function() {
  
  if (checkbox.checked) {
    darkmode();
  } else {
    nodark();
  }
});


function darkmode() {
  document.body.classList.add("light");
  checkbox.checked = true;
  sessionStorage.setItem("mode", "dark"); 
}


function nodark() {
  document.body.classList.remove("light");
  checkbox.checked = false;
  sessionStorage.setItem("mode", "light"); 
}
</script>
<main class="page-content" aria-label="Content">
            <div class="w">

<article class="post-single">
    <header class="post-header">
    <span class="post-tags">
        
            <a href="http://localhost:1313/tags/ctf/">
                 #ctf</a>&nbsp;
        
            <a href="http://localhost:1313/tags/writeup/">
                 #writeup</a>&nbsp;
        
    </span>


<h1 class="post-title">CTF writeup: Snapped Phish-ing Line (TryHackMe)</h1>
        <p class="post-meta">&lt;span title=&#39;2023-07-28 00:00:00 &#43;0000 &#43;0000&#39;&gt;28.07.2023&lt;/span&gt; :: 5 min read :: ogjojo&nbsp;|&nbsp;<a href="https://github.com/linutti/linutti.com/blob/main/content/posts/ctf-thm-snapped-phishing-line.md" rel="noopener noreferrer" target="_blank">SUGGEST CHANGES</a>

</p>
    </header>
    
        <aside ><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">table of contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#the-task" aria-label="The task">The task</a></li>
                <li>
                    <a href="#q1-who-is-the-individual-who-received-an-email-attachment-containing-a-pdf" aria-label="Q1: Who is the individual who received an email attachment containing a PDF?">Q1: Who is the individual who received an email attachment containing a PDF?</a></li>
                <li>
                    <a href="#q2-what-email-address-was-used-by-the-adversary-to-send-the-phishing-emails" aria-label="Q2: What email address was used by the adversary to send the phishing emails?">Q2: What email address was used by the adversary to send the phishing emails?</a></li>
                <li>
                    <a href="#q3-what-is-the-redirection-url-to-the-phishing-page-for-the-individual-zoe-duncan-defanged-format" aria-label="Q3: What is the redirection URL to the phishing page for the individual Zoe Duncan? (defanged format)">Q3: What is the redirection URL to the phishing page for the individual Zoe Duncan? (defanged format)</a></li>
                <li>
                    <a href="#q4-what-is-the-url-to-the-zip-archive-of-the-phishing-kit-defanged-format" aria-label="Q4: What is the URL to the .zip archive of the phishing kit? (defanged format)">Q4: What is the URL to the .zip archive of the phishing kit? (defanged format)</a></li>
                <li>
                    <a href="#q5-what-is-the-sha256-hash-of-the-phishing-kit-archive" aria-label="Q5: What is the SHA256 hash of the phishing kit archive?">Q5: What is the SHA256 hash of the phishing kit archive?</a></li>
                <li>
                    <a href="#q6-when-was-the-phishing-kit-archive-first-submitted-format-yyyy-mm-dd-hhmmss-utc" aria-label="Q6: When was the phishing kit archive first submitted? (format: YYYY-MM-DD HH:MM:SS UTC)">Q6: When was the phishing kit archive first submitted? (format: YYYY-MM-DD HH:MM:SS UTC)</a></li>
                <li>
                    <a href="#q7-when-was-the-phishing-domain-that-was-used-to-host-the-phishing-kit-archive-first-registered-format-yyyy-mm-dd" aria-label="Q7: When was the phishing domain that was used to host the phishing kit archive first registered? (format: YYYY-MM-DD)">Q7: When was the phishing domain that was used to host the phishing kit archive first registered? (format: YYYY-MM-DD)</a></li>
                <li>
                    <a href="#q8-what-was-the-email-address-of-the-user-who-submitted-their-password-twice" aria-label="Q8: What was the email address of the user who submitted their password twice?">Q8: What was the email address of the user who submitted their password twice?</a></li>
                <li>
                    <a href="#q9-what-was-the-email-address-used-by-the-adversary-to-collect-compromised-credentials" aria-label="Q9: What was the email address used by the adversary to collect compromised credentials?">Q9: What was the email address used by the adversary to collect compromised credentials?</a></li>
                <li>
                    <a href="#q10-the-adversary-used-other-email-addresses-in-the-obtained-phishing-kit-what-is-the-email-address-that-ends-in-gmailcom" aria-label="Q10: The adversary used other email addresses in the obtained phishing kit. What is the email address that ends in &amp;ldquo;@gmail.com&amp;rdquo;?">Q10: The adversary used other email addresses in the obtained phishing kit. What is the email address that ends in &ldquo;@gmail.com&rdquo;?</a></li>
                <li>
                    <a href="#q11-what-is-the-hidden-flag" aria-label="Q11: What is the hidden flag?">Q11: What is the hidden flag?</a>
                </li>
            </ul>
        </div>
    </details>
</div>

        </aside>
    <p>Link to challenge: <a href="https://tryhackme.com/room/snappedphishingline">Snapped Phish-ing line</a></p>
<h3 id="the-task">The task<a hidden class="anchor" aria-hidden="true" href="#the-task">#</a></h3>
<blockquote>
<p>An Ordinary Midsummer Day&hellip;
As an IT department personnel of SwiftSpend Financial, one of your responsibilities is to support your fellow employees with their technical concerns. While everything seemed ordinary and mundane, this gradually changed when several employees from various departments started reporting an unusual email they had received. Unfortunately, some had already submitted their credentials and could no longer log in.</p>
<p><strong>You now proceeded to investigate what is going on by:</strong></p>
<ol>
<li>Analysing the email samples provided by your colleagues.</li>
<li>Analysing the phishing URL(s) by browsing it using Firefox.</li>
<li>Retrieving the phishing kit used by the adversary.</li>
<li>Using CTI-related tooling to gather more information about the adversary.</li>
<li>Analysing the phishing kit to gather more information about the adversary.</li>
</ol>
</blockquote>
<p>With that out of the way, let&rsquo;s launch the vm and dive right in!</p>
<h3 id="q1-who-is-the-individual-who-received-an-email-attachment-containing-a-pdf">Q1: Who is the individual who received an email attachment containing a PDF?<a hidden class="anchor" aria-hidden="true" href="#q1-who-is-the-individual-who-received-an-email-attachment-containing-a-pdf">#</a></h3>
<p>This first one doesn&rsquo;t require a lot of research. Looking through the emails provided to us in the vm we can quite easily find the email that contains the <code>.pdf</code> attachment.
It&rsquo;s a file called <strong>Quote.pdf</strong> which was sent to <em><strong>William ****</strong></em>.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/00.webp" alt="00"></p>
<h3 id="q2-what-email-address-was-used-by-the-adversary-to-send-the-phishing-emails">Q2: What email address was used by the adversary to send the phishing emails?<a hidden class="anchor" aria-hidden="true" href="#q2-what-email-address-was-used-by-the-adversary-to-send-the-phishing-emails">#</a></h3>
<p>The email address from which these emails were sent from can be seen in the <em>From</em> header of the email (<em><strong>Accounts.****@****.icu</strong></em>).</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/01.webp" alt="01"></p>
<h3 id="q3-what-is-the-redirection-url-to-the-phishing-page-for-the-individual-zoe-duncan-defanged-format">Q3: What is the redirection URL to the phishing page for the individual Zoe Duncan? (defanged format)<a hidden class="anchor" aria-hidden="true" href="#q3-what-is-the-redirection-url-to-the-phishing-page-for-the-individual-zoe-duncan-defanged-format">#</a></h3>
<p>Saving one of the html attachments from one of the phishing emails and opening it in a text editor, we find the redirection URL. Let&rsquo;s copy it and defang it.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/02.webp" alt="02"></p>
<p>Open up Firefox within the VM and navigate to CyberShef (can be found in the bookmarks).</p>
<ol>
<li>Search for &ldquo;<em>defang</em>&rdquo;</li>
<li>Select &ldquo;<em>Defang URL</em>&rdquo;</li>
<li>Paste the URL in the <em>Input</em> box</li>
<li>Copy the defanged URL from the <em>Output</em> box (<em><strong>hxxp[://]kennaroads[.]&hellip;</strong></em>)</li>
</ol>
<p><img src="/pics/ctf-thm-snapped-phishing-line/03.webp" alt="03"></p>
<h3 id="q4-what-is-the-url-to-the-zip-archive-of-the-phishing-kit-defanged-format">Q4: What is the URL to the .zip archive of the phishing kit? (defanged format)<a hidden class="anchor" aria-hidden="true" href="#q4-what-is-the-url-to-the-zip-archive-of-the-phishing-kit-defanged-format">#</a></h3>
<p>Looking at the URL we see that there is a directory called <code>/data</code>. Hmm&hellip; can we access that directory?ðŸ¤”</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/04.webp" alt="04"></p>
<p>Yes, yes we can! We have access and there is the <strong>Update365.zip</strong> file.
Let&rsquo;s copy the URL and defang it just like we did with the URL before&hellip;</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/05.webp" alt="05"></p>
<h3 id="q5-what-is-the-sha256-hash-of-the-phishing-kit-archive">Q5: What is the SHA256 hash of the phishing kit archive?<a hidden class="anchor" aria-hidden="true" href="#q5-what-is-the-sha256-hash-of-the-phishing-kit-archive">#</a></h3>
<p>We need to download the <code>.zip</code> to get the SHA256. Once downloaded,
we can run the command <code>sha256sum Update365.zip</code> to get the SHA256 hash of the archive.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/06.webp" alt="06"></p>
<h3 id="q6-when-was-the-phishing-kit-archive-first-submitted-format-yyyy-mm-dd-hhmmss-utc">Q6: When was the phishing kit archive first submitted? (format: YYYY-MM-DD HH:MM:SS UTC)<a hidden class="anchor" aria-hidden="true" href="#q6-when-was-the-phishing-kit-archive-first-submitted-format-yyyy-mm-dd-hhmmss-utc">#</a></h3>
<p>Copying the SHA256 hash and pasting it into Virustotal gives us more information about the archive.
It&rsquo;s detected as malicious by 22/61 vendors (that&rsquo;s good!), but that&rsquo;s not what we&rsquo;re looking for.
We want to find out when it was first submitted. For that we need to navigate to the <em>Details</em> tab and scroll down to <em>History</em>.
Here we can see the <em>First Submission</em> date and time.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/07.webp" alt="07"></p>
<h3 id="q7-when-was-the-phishing-domain-that-was-used-to-host-the-phishing-kit-archive-first-registered-format-yyyy-mm-dd">Q7: When was the phishing domain that was used to host the phishing kit archive first registered? (format: YYYY-MM-DD)<a hidden class="anchor" aria-hidden="true" href="#q7-when-was-the-phishing-domain-that-was-used-to-host-the-phishing-kit-archive-first-registered-format-yyyy-mm-dd">#</a></h3>
<p>Now let&rsquo;s navigate over to ThreatBook and search for the URL &ldquo;<em>kennaroads.buzz</em>&rdquo;.
Under the <em>Whois</em> tab we can see the date and time when the domain was registered.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/08.webp" alt="08"></p>
<h3 id="q8-what-was-the-email-address-of-the-user-who-submitted-their-password-twice">Q8: What was the email address of the user who submitted their password twice?<a hidden class="anchor" aria-hidden="true" href="#q8-what-was-the-email-address-of-the-user-who-submitted-their-password-twice">#</a></h3>
<p>Going back over to the <code>/data</code> directory we discovered earlier,
we see that there is another directory called <code>/Update365</code> within the <code>/data</code> directory.
If we open that up we find a delicious looking <em>log</em> file called <strong>log.txt</strong>.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/09.webp" alt="09"></p>
<p>Opening up the <strong>log.txt</strong> file gives us all the saved data from the form on the phishing website.
Upon further inspection, we can see that one poor employee submitted their password twice.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/10.webp" alt="10"></p>
<h3 id="q9-what-was-the-email-address-used-by-the-adversary-to-collect-compromised-credentials">Q9: What was the email address used by the adversary to collect compromised credentials?<a hidden class="anchor" aria-hidden="true" href="#q9-what-was-the-email-address-used-by-the-adversary-to-collect-compromised-credentials">#</a></h3>
<p>Going back to our terminal, we can extract the <code>.zip</code> we downloaded earlier to have a closer look at the guts of the archive.</p>
<div class="highlight"><pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>unzip Update365.zip
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">cd</span> Update365
</span></span></code></pre></div><p>Now, there are many ways of finding the email addresses (manually browsing the files is one), but let&rsquo;s do some âœ¨grep magicâœ¨.</p>
<p>Running <code>grep -srhw &quot;[[:alnum:]]\+@[[:alnum:]]\+&quot; | sort | uniq</code> will recursivly look through the files and try to match anything that looks like an email address.
Piping the output to <code>sort</code> and then to <code>uniq</code> gives us more readable output.</p>
<p>As you can see below, this output gives us 3 results. 2 of which are useful and 1 red herring!</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/11.webp" alt="11"></p>
<h3 id="q10-the-adversary-used-other-email-addresses-in-the-obtained-phishing-kit-what-is-the-email-address-that-ends-in-gmailcom">Q10: The adversary used other email addresses in the obtained phishing kit. What is the email address that ends in &ldquo;@gmail.com&rdquo;?<a hidden class="anchor" aria-hidden="true" href="#q10-the-adversary-used-other-email-addresses-in-the-obtained-phishing-kit-what-is-the-email-address-that-ends-in-gmailcom">#</a></h3>
<p>Answer found while looking for the email address in the previous task.</p>
<h3 id="q11-what-is-the-hidden-flag">Q11: What is the hidden flag?<a hidden class="anchor" aria-hidden="true" href="#q11-what-is-the-hidden-flag">#</a></h3>
<p>Now let&rsquo;s find that flag!ðŸš©</p>
<p>The hint says:</p>
<blockquote>
<p>The flag contains a &ldquo;.txt&rdquo; extension and, with some adjustments,
should be downloadable from the phishing URL.
Look for the flag in every subdomain/directory of the phishing URL.</p>
</blockquote>
<p>Opening up the browser again and navigating over to the <code>/data</code> directory,
the only direcoty we haven&rsquo;t yet taken a look at is <code>/data/Update356/office365</code>.
However, trying to open the directory takes us down the path to some destination
which gives us a <code>Not Found</code> error:</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/13.webp" alt="13"></p>
<p>I wonder&hellip; can the flag be in the <code>/data/Update356/office365</code> directory?</p>
<p>Trying to manually look inside the <code>/office365</code> dir for a <code>flag.txt</code> file does sure enough
yield a successful outcome!</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/14.webp" alt="14"></p>
<p>Let&rsquo;s see what this string is by using CyberShef&rsquo;s <code>Magic</code> operation. It&rsquo;s Base64 and the string is reversed.
Using CyberShef&rsquo;s <code>From Base64</code> operation in combination with <code>Reverse</code> we should get the desired output.</p>
<p>NOTE: You cannot reverse the Base64 string before decoding it. The string has to be decoded and then reversed.
Kind of obvious in this case but good to keep in mind.</p>
<p><img src="/pics/ctf-thm-snapped-phishing-line/15.webp" alt="15"></p>
<p>And there we have it!</p>
<hr>
<p>Thank you for reading my writeup of this CTF challenge! Have a nice day! :)</p>


</article>
<footer class="post-footer">
    <span class="post-tags">
        
            <a href="http://localhost:1313/tags/ctf/">
                 #ctf</a>&nbsp;
        
            <a href="http://localhost:1313/tags/writeup/">
                 #writeup</a>&nbsp;
        
    </span>


</footer>

            </div>
        </main>
    </body>
</html>
